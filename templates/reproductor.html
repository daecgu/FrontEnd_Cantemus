{% extends "base.html" %}
{% block style %}
        .diapositiva-control {
            border: 1px solid #ccc; /* Borde gris claro */
            padding: 5px; /* Espaciado interno */
            margin: 5px; /* Espaciado externo */
            cursor: pointer; /* Cambia el cursor a una mano para indicar que es clickeable */
            display: inline-block; /* Asegura que las cajas se muestren en línea */
            background-color: #f8f8f8; /* Fondo claro para las cajas */
        }

        .diapositiva-control:hover {
            background-color: #e8e8e8; /* Cambia el fondo al pasar el mouse */
        }

        .diapositiva-control.especial {
            /* Estilos adicionales para la caja 'Especial' si es necesario */
        }
{% endblock %}

{% block content %}
<a href="/">Inicio</a> <!-- Botón para ir a la página de inicio -->
<a href="/listado-canciones">Listado de canciones</a> <!-- Botón para ir a la página de listado de canciones -->

<div id="diapositiva-container">
    <div id="diapositiva-actual">Cargando diapositivas...</div>
    <br>
    <div id="info-cancion">
        <span id="titulo-cancion"></span> - <span id="artista-cancion"></span>
    </div>
</div>
<div id="controles-reproductor">
    <button id="anterior" disabled>Anterior</button>
    <button id="siguiente" disabled>Siguiente</button>
</div>
<!-- Contenedor para selección de diapositivas -->
<div id="seleccion-diapositivas">
    <!-- Las cajas de selección de diapositivas se generarán aquí -->
</div>

<form id="idCancionForm">
    <input type="text" id="idCancion" name="idCancion" placeholder="ID de la canción" required>
    <button type="submit">Cargar Canción</button>
</form>

<script>
// Variables globales para las diapositivas y los elementos de la interfaz de usuario
let diapositivas = [];
let indiceActual = 0;

// Actualizar la diapositiva actual basándose en el índiceActual
function actualizarDiapositiva() {
    const diapositivaActualDiv = document.getElementById('diapositiva-actual');
    // Reemplazar los saltos de línea por elementos <br>
    diapositivaActualDiv.innerHTML = diapositivas[indiceActual].replace(/\n/g, '<br>');
    document.getElementById('anterior').disabled = indiceActual === 0;
    document.getElementById('siguiente').disabled = indiceActual === diapositivas.length - 1;
}

// Manejar el envío del formulario y cargar las diapositivas
document.getElementById('idCancionForm').addEventListener('submit', function(e) {
    e.preventDefault();
    const idCancion = document.getElementById('idCancion').value;

    fetch(`http://127.0.0.1:8000/canciones/${idCancion}/diapositivas`)
    .then(response => response.json())
    .then(data => {
        diapositivas = data.diapositivas;
        document.getElementById('titulo-cancion').textContent = data.titulo;
        document.getElementById('artista-cancion').textContent = data.artista;

        // Reestablecer el índice y actualizar la interfaz
        indiceActual = 0;
        actualizarDiapositiva();
        generarControlesDiapositivas(); // Generar los controles de selección de diapositivas
    })
    .catch(error => {
        console.error('Error:', error);
        alert('Error al cargar las diapositivas. Por favor, verifica que el ID es correcto.');
    });
});

// Manejar clic en el botón "Anterior"
document.getElementById('anterior').addEventListener('click', function() {
    if (indiceActual > 0) {
        indiceActual--;
        actualizarDiapositiva();
    }
});

// Manejar clic en el botón "Siguiente"
document.getElementById('siguiente').addEventListener('click', function() {
    if (indiceActual < diapositivas.length - 1) {
        indiceActual++;
        actualizarDiapositiva();
    }
});

// Manejar las teclas de flecha para la navegación de diapositivas
document.addEventListener('keydown', function(event) {
    if (event.key === 'ArrowLeft' && indiceActual > 0) {
        indiceActual--;
        actualizarDiapositiva();
    } else if (event.key === 'ArrowRight' && indiceActual < diapositivas.length - 1) {
        indiceActual++;
        actualizarDiapositiva();
    }
});

// Generar controles de selección de diapositivas
function generarControlesDiapositivas() {
    const seleccionDiv = document.getElementById('seleccion-diapositivas');
    seleccionDiv.innerHTML = ''; // Limpia los controles existentes
    diapositivas.forEach((diapositiva, index) => {
        const diapositivaDiv = document.createElement('div');
        // Usa innerHTML y reemplaza \n con <br> para mantener los saltos de línea
        diapositivaDiv.innerHTML = diapositiva.replace(/\n/g, '<br>') || 'Sin texto';
        diapositivaDiv.className = 'diapositiva-control';
        diapositivaDiv.onclick = () => seleccionarDiapositiva(index);
        seleccionDiv.appendChild(diapositivaDiv);
    });

    // Agrega la caja especial para la diapositiva sin texto
    const diapositivaEspecialDiv = document.createElement('div');
    diapositivaEspecialDiv.innerHTML = 'Especial'; // Aquí no hay saltos de línea
    diapositivaEspecialDiv.className = 'diapositiva-control especial';
    diapositivaEspecialDiv.onclick = () => seleccionarDiapositivaEspecial();
    seleccionDiv.appendChild(diapositivaEspecialDiv);
}

// Función para manejar la selección de diapositiva
function seleccionarDiapositiva(index) {
    indiceActual = index;
    actualizarDiapositiva();
}

// Función para la diapositiva especial sin texto
function seleccionarDiapositivaEspecial() {
    const diapositivaActualDiv = document.getElementById('diapositiva-actual');
    diapositivaActualDiv.innerHTML = ''; // Limpia la diapositiva actual
    // Restablece cualquier otro estado si es necesario
}
</script>
{% endblock %}
